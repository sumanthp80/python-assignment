# Orders Application

This project contains source code and supporting files for an orders application. It includes the following files and folders.

- orders.py - Code for the application's processing of the online orders CSV file named orders.csv.
- orders.csv - Test CSV orders file used by main program orders.py for processing
- requirements.txt - contains dependencies for the module
- Dockerfile - orders.py and its dependencies are bundled together in this file
- Docker-compose.yml (root directory) - This file has main orders service which reads orders.csv file from root directory of repositry and processed by main module
- test/unit/requirements.txt - contains dependencies for the test module
- tests/unit/test_orders.py - Unit tests for the application code. 
- Dockerfile.tests - This dockerfile from root directory is used for unit testing the orders.py. This file uses the code from tests/ folder
- test/docker-compose.yml - This file is used to build the test service by using Dockerfile.tests file from root directory

# Dependencies

Make sure you have the pandas library installed (pip install pandas) before running the code. Also, ensure that the orders.csv file is in the same directory as the Python script.

# Code overview

This program reads the CSV file using pd.read_csv() and converts the order_date column to a datetime type using pd.to_datetime(). Then, it calculates the total revenue generated by the online store for each month, the total revenue generated by each product, and the total revenue generated by each customer using the groupby() function. Finally, it identifies the top 10 customers by revenue generated using the nlargest() function.

## Commands to execute in root directory for main_code service

- docker-compose build  - to build the docker image
- docker-compose up     - to run the main_code service

The main_code service builds an image using the Dockerfile and runs the main code using the python orders.py command. The orders.csv file from root directory is mounted into the container to provide the data.

## Tests

Tests are defined in the `tests` folder in this project. Use PIP to install the test dependencies and run tests.
*****************************************************************

In these tests, we create sample CSV data using the StringIO module and test the output of each function against the expected results using assertions. The pytest framework will automatically detect and run these tests when executed.

Make sure you have the pytest library installed (pip install pytest) before running the tests. You can run the tests by executing pytest in the terminal or by running your Python script with the following command: python -m pytest tests/. 

## Running Testcases using Dockerfiles 
Go to tests sub-directory from root directory and execute below commands:

- docker-compose build  - to build the docker image
- docker-compose up     - to run the tests service

In the test docker-compose.yml file, we define tests service. 

The tests service builds an image using the Dockerfile.tests and runs the tests using the pytest -v test_orders.py command. Similarly, the orders.csv file is mounted into the container for testing.

To run the code and tests using Docker, make sure you have Docker and Docker Compose installed. Place the Dockerfile, Dockerfile.tests, docker-compose.yml (main_code), orders.py, in the same directory as your orders.csv file.

docker-compose.yml (tests service) and unit/test_orders.py files are in the tests directory.

Docker Compose will build the images and run the containers for the main code and tests. You will see the output of the main code and the test results in the terminal.

Note: Update the file names and paths in the Dockerfiles and Docker Compose file if your file names or directory structure is different.

## Clean up of running containers
- docker-compose down  # Stop and remove containers, networks
